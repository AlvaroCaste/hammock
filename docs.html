<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Hammock</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Purely functional HTTP client" /><meta name="author" content="com.pepegar" /><meta name="og:image" content="/hammock/img/poster.png" /><meta name="og:title" content="Hammock" /><meta name="og:site_name" content="Hammock" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Purely functional HTTP client" /><meta name="twitter:image" content="/hammock/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/hammock/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/hammock/highlight/styles/tomorrow.css" /><link rel="stylesheet" href="/hammock/css/style.css" /><link rel="stylesheet" href="/hammock/css/palette.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/hammock/" class="brand"><div class="brand-wrapper" style="background:url('/hammock/img/sidebar_brand.png') no-repeat"><span>Hammock</span></div></a></li><li><a href="/hammock/docs.html" class=" active "></a></li><li><a href="/hammock/css/palette.css" class=" active "></a></li><li><a href="/hammock/css/style.css" class=" active "></a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/pepegar/hammock"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/pepegar/hammock"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Hammock Purely functional HTTP client');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Hammock Purely functional HTTP client');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="pepegar" data-github-repo="hammock"><div class="content-wrapper"><section><h1 id="low-level-dsl">Low level DSL</h1>

<p>Imagine you were already using free monads for desiginng your
application:</p>

<p>As always, start with some imports</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats._</span>
<span class="k">import</span> <span class="nn">cats.free._</span>
<span class="k">import</span> <span class="nn">cats.data._</span>
</code></pre>
</div>

<h2 id="algebras">Algebras</h2>

<p>Then, we need to start defining our algebras. Hereâ€™s is the algebra
related to logging</p>

<h3 id="log">Log</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">Log</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">LogF</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
  <span class="nc">case</span> <span class="k">class</span> <span class="nc">Info</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">LogF</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">Error</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">LogF</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>

  <span class="k">class</span> <span class="nc">LogC</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">LogF</span>, <span class="kt">F</span><span class="o">])</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">info</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="nc">Info</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span>
    <span class="k">def</span> <span class="n">error</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="nc">Error</span><span class="o">(</span><span class="n">msg</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">object</span> <span class="nc">LogC</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">def</span> <span class="n">logC</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">LogF</span>, <span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">LogC</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LogC</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">interp</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="nc">ME</span><span class="k">:</span> <span class="kt">MonadError</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Throwable</span><span class="o">])</span><span class="k">:</span> <span class="kt">LogF</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="k">new</span> <span class="o">(</span><span class="nc">LogF</span> <span class="o">~&gt;</span> <span class="n">F</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">logF</span><span class="k">:</span> <span class="kt">LogF</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>  <span class="n">logF</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Info</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">ME</span><span class="o">.</span><span class="n">catchNonFatal</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"[info]: $msg"</span><span class="o">))</span>
      <span class="k">case</span> <span class="nc">Error</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">ME</span><span class="o">.</span><span class="n">catchNonFatal</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"[error]: $msg"</span><span class="o">))</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// warning: there were three feature warnings; re-run with -feature for details
// defined object Log
</span></code></pre>
</div>

<h3 id="io">IO</h3>

<p>And this one does IO.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">IO</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">IOF</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
  <span class="nc">case</span> <span class="k">object</span> <span class="nc">Read</span> <span class="k">extends</span> <span class="nc">IOF</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">Write</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">IOF</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>

  <span class="k">class</span> <span class="nc">IOC</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">IOF</span>, <span class="kt">F</span><span class="o">])</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">read</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="nc">Read</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">write</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Free</span><span class="o">.</span><span class="n">inject</span><span class="o">(</span><span class="nc">Write</span><span class="o">(</span><span class="n">str</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">object</span> <span class="nc">IOC</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">def</span> <span class="n">ioC</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">IOF</span>, <span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">IOC</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IOC</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span>
  <span class="o">}</span>

  <span class="k">import</span> <span class="nn">scala.io.StdIn._</span>

  <span class="k">def</span> <span class="n">interp</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="nc">ME</span><span class="k">:</span> <span class="kt">MonadError</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Throwable</span><span class="o">])</span><span class="k">:</span> <span class="kt">IOF</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="k">new</span> <span class="o">(</span><span class="nc">IOF</span> <span class="o">~&gt;</span> <span class="n">F</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">ioF</span><span class="k">:</span> <span class="kt">IOF</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">ioF</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Read</span> <span class="k">=&gt;</span> <span class="nc">ME</span><span class="o">.</span><span class="n">catchNonFatal</span><span class="o">(</span><span class="n">readLine</span> <span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">Write</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">ME</span><span class="o">.</span><span class="n">catchNonFatal</span><span class="o">(</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"$msg"</span><span class="o">))</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="combining-our-effects">Combining our effects</h2>

<p>And finally, we should need to build everything together. For that
purpose, we will need a <code class="highlighter-rouge">Coproduct</code>. This datatype basically tells the
typesystem about our effects, saying that our <code class="highlighter-rouge">Eff</code> type can be either
a <code class="highlighter-rouge">Log</code> or a <code class="highlighter-rouge">IO</code> value.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">IO._</span>
  <span class="k">import</span> <span class="nn">Log._</span>

  <span class="k">type</span> <span class="kt">Eff</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">LogF</span>, <span class="kt">IOF</span>, <span class="kt">A</span><span class="o">]</span>

  <span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="s">"pepegar"</span>

  <span class="k">def</span> <span class="n">program</span><span class="o">(</span><span class="k">implicit</span> <span class="nc">Log</span><span class="k">:</span> <span class="kt">LogC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">],</span> <span class="nc">IO</span><span class="k">:</span> <span class="kt">IOC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">])</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="c1">// this dinamically generated documentation, we cannot ask for input, but we should do `name &lt;- IO.read`
</span>    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">Log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="n">s</span><span class="s">"name was $name"</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="n">s</span><span class="s">"hello $name"</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">name</span>

  <span class="k">def</span> <span class="n">interp</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="nc">ME</span><span class="k">:</span> <span class="kt">MonadError</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Throwable</span><span class="o">])</span><span class="k">:</span> <span class="kt">Eff</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="nc">Log</span><span class="o">.</span><span class="n">interp</span> <span class="n">or</span> <span class="nc">IO</span><span class="o">.</span><span class="n">interp</span>
<span class="o">}</span>
</code></pre>
</div>

<p>You could use this as follows:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scala.util.Try</span>
<span class="k">import</span> <span class="nn">scala.util.Try</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">App</span><span class="o">.</span><span class="n">program</span> <span class="n">foldMap</span> <span class="nc">App</span><span class="o">.</span><span class="n">interp</span><span class="o">[</span><span class="kt">Try</span><span class="o">]</span>
<span class="o">[</span><span class="kt">info</span><span class="o">]</span><span class="k">:</span> <span class="kt">name</span> <span class="kt">was</span> <span class="kt">pepegar</span>
<span class="n">hello</span> <span class="n">pepegar</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="n">pepegar</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="interleaving-hammock-in-a-free-program">Interleaving Hammock in a Free program</h2>

<p>Normally, extending this kind of programs is a bit cumbersome because
you need to write all the boilerplate to embed a library into a
free-based architecture, and then use it yourself.  However, with
Hammock, you can import <code class="highlighter-rouge">hammock.free._</code> and enjoy:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">hammock.Uri</span>
  <span class="k">import</span> <span class="nn">IO._</span>
  <span class="k">import</span> <span class="nn">Log._</span>
  <span class="k">import</span> <span class="nn">cats._</span>
  <span class="k">import</span> <span class="nn">hammock.free.algebra._</span>
  <span class="k">import</span> <span class="nn">hammock.jvm.free._</span>

  <span class="k">type</span> <span class="kt">Eff1</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">LogF</span>, <span class="kt">IOF</span>, <span class="kt">A</span><span class="o">]</span>
  <span class="k">type</span> <span class="kt">Eff</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">HttpRequestF</span>, <span class="kt">Eff1</span>, <span class="kt">A</span><span class="o">]</span>

  <span class="k">def</span> <span class="n">program</span><span class="o">(</span><span class="k">implicit</span>
    <span class="nc">Log</span><span class="k">:</span> <span class="kt">LogC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">],</span>
    <span class="nc">IO</span><span class="k">:</span> <span class="kt">IOC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">],</span>
    <span class="nc">Hammock</span><span class="k">:</span> <span class="kt">HttpRequestC</span><span class="o">[</span><span class="kt">Eff</span><span class="o">]</span>
  <span class="o">)</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="s">"What's the ID?"</span><span class="o">)</span>
    <span class="n">id</span> <span class="k">=</span> <span class="s">"4"</span> <span class="c1">// for the sake of docs, lets hardcode this... It should be `id &lt;- IO.read`
</span>    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">Log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="n">s</span><span class="s">"id was $id"</span><span class="o">)</span>
    <span class="n">response</span> <span class="k">&lt;-</span> <span class="nc">Hammock</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="nc">Uri</span><span class="o">.</span><span class="n">unsafeParse</span><span class="o">(</span><span class="s">"https://jsonplaceholder.typicode.com/users?id=${id.toString}"</span><span class="o">),</span> <span class="nc">Map</span><span class="o">())</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">response</span>

  <span class="k">def</span> <span class="n">interp1</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="nc">ME</span><span class="k">:</span> <span class="kt">MonadError</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Throwable</span><span class="o">])</span><span class="k">:</span> <span class="kt">Eff1</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="nc">Log</span><span class="o">.</span><span class="n">interp</span><span class="o">(</span><span class="nc">ME</span><span class="o">)</span> <span class="n">or</span> <span class="nc">IO</span><span class="o">.</span><span class="n">interp</span><span class="o">(</span><span class="nc">ME</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">interp</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="nc">ME</span><span class="k">:</span> <span class="kt">MonadError</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Throwable</span><span class="o">])</span><span class="k">:</span> <span class="kt">Eff</span> <span class="kt">~&gt;</span> <span class="kt">F</span> <span class="o">=</span> <span class="nc">Interpreter</span><span class="o">().</span><span class="n">trans</span><span class="o">(</span><span class="nc">ME</span><span class="o">)</span> <span class="n">or</span> <span class="n">interp1</span><span class="o">(</span><span class="nc">ME</span><span class="o">)</span> <span class="c1">// interpret Hammock's effects
</span><span class="o">}</span>
</code></pre>
</div>

<h3 id="result">Result</h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scala.util.Try</span>
<span class="k">import</span> <span class="nn">scala.util.Try</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">App</span><span class="o">.</span><span class="n">program</span> <span class="n">foldMap</span> <span class="nc">App</span><span class="o">.</span><span class="n">interp</span><span class="o">[</span><span class="kt">Try</span><span class="o">]</span>
<span class="nc">What</span><span class="ss">'s </span><span class="n">the</span> <span class="nc">ID</span><span class="o">?</span>
<span class="o">[</span><span class="kt">info</span><span class="o">]</span><span class="k">:</span> <span class="kt">id</span> <span class="kt">was</span> <span class="err">4</span>
<span class="kt">res1:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">hammock.HttpResponse</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">IllegalArgumentException</span><span class="k">:</span> <span class="kt">Illegal</span> <span class="kt">character</span> <span class="kt">in</span> <span class="kt">query</span> <span class="kt">at</span> <span class="kt">index</span> <span class="err">47</span><span class="kt">:</span> <span class="kt">https://jsonplaceholder.typicode.com/users?id</span><span class="o">=</span><span class="n">$</span><span class="o">{</span><span class="n">id</span><span class="o">.</span><span class="n">toString</span><span class="o">})</span>
</code></pre>
</div>

<h1 id="high-level-dsl">High level DSL</h1>

<p>This package provides a high level DSL to use Hammock without the
hassle of dealing with Free monads, interpreters, and so on.</p>

<p>Of course, youâ€™re still able to use lo level API if needed to create
your requests.</p>

<h2 id="example-of-use">Example of use</h2>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">hammock._</span>
<span class="c1">// import hammock._
</span>
<span class="k">import</span> <span class="nn">hammock.jvm.free.Interpreter</span>
<span class="c1">// import hammock.jvm.free.Interpreter
</span>
<span class="k">import</span> <span class="nn">hammock.hi._</span>
<span class="c1">// import hammock.hi._
</span>
<span class="k">import</span> <span class="nn">hammock.hi.dsl._</span>
<span class="c1">// import hammock.hi.dsl._
</span>
<span class="k">import</span> <span class="nn">cats._</span>
<span class="c1">// import cats._
</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>
<span class="c1">// import cats.implicits._
</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">interp</span> <span class="k">=</span> <span class="nc">Interpreter</span><span class="o">()</span>
<span class="c1">// interp: hammock.jvm.free.Interpreter = hammock.jvm.free.Interpreter@497f9a54
</span>
<span class="k">val</span> <span class="n">opts</span> <span class="k">=</span> <span class="o">(</span><span class="n">header</span><span class="o">(</span><span class="s">"user"</span> <span class="o">-&gt;</span> <span class="s">"pepegar"</span><span class="o">)</span> <span class="o">&amp;&gt;</span> <span class="n">cookie</span><span class="o">(</span><span class="nc">Cookie</span><span class="o">(</span><span class="s">"track"</span><span class="o">,</span> <span class="s">"a lot"</span><span class="o">)))(</span><span class="nc">Opts</span><span class="o">.</span><span class="n">default</span><span class="o">)</span>
<span class="c1">// opts: hammock.hi.Opts = Opts(None,Map(user -&gt; pepegar),None)
</span>
<span class="k">val</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">Hammock</span><span class="o">.</span><span class="n">getWithOpts</span><span class="o">(</span><span class="nc">Uri</span><span class="o">.</span><span class="n">unsafeParse</span><span class="o">(</span><span class="s">"http://httpbin.org/get"</span><span class="o">),</span> <span class="n">opts</span><span class="o">).</span><span class="n">exec</span><span class="o">[</span><span class="kt">Try</span><span class="o">]</span>
<span class="c1">// response: scala.util.Try[hammock.HttpResponse] = Success(HttpResponse(Status(200,OK,OK),Map(Access-Control-Allow-Origin -&gt; *, Server -&gt; gunicorn/19.7.1, Access-Control-Allow-Credentials -&gt; true, Connection -&gt; keep-alive, Content-Length -&gt; 293, Via -&gt; 1.1 vegur, Content-Type -&gt; application/json, Date -&gt; Mon, 03 Apr 2017 16:16:45 GMT),{  "args": {},   "headers": {    "Accept-Encoding": "gzip,deflate",     "Connection": "close",     "Host": "httpbin.org",     "User": "pepegar,pepegar",     "User-Agent": "Apache-HttpClient/4.5.2 (Java/1.8.0_77)"  },   "origin": "79.153.126.148",   "url": "http://httpbin.org/get"}))
</span></code></pre>
</div>

<h2 id="opts">Opts</h2>

<p>The high level DSL uses a <code class="highlighter-rouge">Opts</code> datatype for describing the request.
This <code class="highlighter-rouge">Opts</code> type is later compiled by the <code class="highlighter-rouge">withOpts</code> methods to the
<code class="highlighter-rouge">Free</code> representation of the request.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Opts</span><span class="o">(</span>
  <span class="n">auth</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Auth</span><span class="o">],</span>
  <span class="n">headers</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">],</span>
  <span class="n">cookies</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Cookie</span><span class="o">]])</span>
</code></pre>
</div>

<p>All the combinators for manipulating the <code class="highlighter-rouge">Opts</code> type return a value of
the type <code class="highlighter-rouge">Opts =&gt; Opts</code>, so you can combine directly via the <code class="highlighter-rouge">andThen</code>
combinator of <code class="highlighter-rouge">Function1</code>.  Also, Hammock provides a helper combinator
<code class="highlighter-rouge">&amp;&gt;</code> for composing <code class="highlighter-rouge">Opts =&gt; Opts</code> functions.</p>

<h3 id="combinators-that-operate-on-opts">Combinators that operate on <code class="highlighter-rouge">Opts</code></h3>

<table>
  <thead>
    <tr>
      <th>signature</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">auth(a: Auth): Opts =&gt; Opts</code></td>
      <td>Sets the <code class="highlighter-rouge">auth</code> field in opts</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookies_!(cookies: List[Cookie]): Opts =&gt; Opts</code></td>
      <td>Substitutes the current value of <code class="highlighter-rouge">cookies</code> in the given <code class="highlighter-rouge">Opts</code> by its param.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookies(cookies: List[Cookie]): Opts =&gt; Opts</code></td>
      <td>Appends the given cookies to the current value of <code class="highlighter-rouge">cookies</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookie(cookie: Cookie): Opts =&gt; Opts</code></td>
      <td>Adds the given <code class="highlighter-rouge">Cookie</code> to the <code class="highlighter-rouge">Opts</code> value.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">headers_!(headers: Map[String, String]): Opts =&gt; Opts</code></td>
      <td>Sets the <code class="highlighter-rouge">headers</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">headers(headers: Map[String, String]): Opts =&gt; Opts</code></td>
      <td>Appends the given <code class="highlighter-rouge">headers</code> to the former ones.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">header(header: (String, String)): Opts =&gt; Opts</code></td>
      <td>Appends current <code class="highlighter-rouge">header</code> (a <code class="highlighter-rouge">(String, String)</code> value) to the headers map.</td>
    </tr>
  </tbody>
</table>

<p>Hereâ€™s an example of how can you use the high level DSL:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">req</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">auth</span><span class="o">(</span><span class="nc">Auth</span><span class="o">.</span><span class="nc">BasicAuth</span><span class="o">(</span><span class="s">"pepegar"</span><span class="o">,</span> <span class="s">"p4ssw0rd"</span><span class="o">))</span> <span class="o">&amp;&gt;</span>
    <span class="n">cookie</span><span class="o">(</span><span class="nc">Cookie</span><span class="o">(</span><span class="s">"track"</span><span class="o">,</span> <span class="s">"A lot"</span><span class="o">))</span> <span class="o">&amp;&gt;</span>
    <span class="n">header</span><span class="o">(</span><span class="s">"user"</span> <span class="o">-&gt;</span> <span class="s">"potatoman"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// req: hammock.hi.Opts =&gt; hammock.hi.Opts = &lt;function1&gt;
</span></code></pre>
</div>

<h4 id="authentication">Authentication</h4>

<p>There are a number of authentication headers already implemented in
Hammock:</p>

<ul>
  <li><strong>Basic auth</strong> (<code class="highlighter-rouge">Auth.BasicAuth(user: String, pass: String)</code>): Authenticate with user and password.</li>
  <li><strong>OAuth2 Bearer token</strong> (<code class="highlighter-rouge">Auth.OAuth2Bearer(token: String)</code>): Authenticate with an OAuth2 Bearer
token. This is treated by many services like a user/password pair</li>
  <li><strong>OAuth2 token</strong> (<code class="highlighter-rouge">Auth.OAuth2Token(token: String)</code>): This is a <em>not really standard</em> bearer token.
Will be treated by services as user/password.</li>
</ul>

<h4 id="cookies">Cookies</h4>

<p>Cookies in Hammock are represented by the <code class="highlighter-rouge">Cookie</code> type:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="nd">@Lenses</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Cookie</span><span class="o">(</span>
  <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">value</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">expires</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Date</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">maxAge</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">domain</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">path</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">secure</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">httpOnly</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">sameSite</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">SameSite</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
  <span class="n">custom</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">None</span><span class="o">)</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">@Lenses</code> annotation (from Monocle) provides lenses for all the
fields in a case class.</p>

<p>As you can see most of the behaviour of the cookie can be handled by
the type itself.  For example, adding a <code class="highlighter-rouge">MaxAge</code> setting to a cookie
is just matter of doing:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">cookie</span> <span class="k">=</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"_ga"</span><span class="o">,</span> <span class="s">"werwer"</span><span class="o">)</span>
<span class="c1">// cookie: hammock.hi.Cookie = Cookie(_ga,werwer,None,None,None,None,None,None,None,None)
</span>
<span class="nc">Cookie</span><span class="o">.</span><span class="n">maxAge</span><span class="o">.</span><span class="n">set</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="mi">234</span><span class="o">))(</span><span class="n">cookie</span><span class="o">)</span>
<span class="c1">// res2: hammock.hi.Cookie = Cookie(_ga,werwer,None,Some(234),None,None,None,None,None,None)
</span></code></pre>
</div>

<h4 id="headers">Headers</h4>

<p>Headers in the <code class="highlighter-rouge">Opts</code> type are represented by a <code class="highlighter-rouge">Map[String, String]</code>.
In this field, you normally want to put all the headers that are not
strictly cookies or authentication header.</p>

<h1 id="codecs">Codecs</h1>

<p>Hammock uses a typeclass <code class="highlighter-rouge">Codec[A]</code> for encoding request bodies and
decoding response contents.  Its signature is the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import hammock.CodecException

trait Codec[A] {
  def encode(a: A): String
  def decode(str: String): Either[CodecException, A]
}
</code></pre>
</div>

<p>Currently, this interface is implemented for <code class="highlighter-rouge">circe</code> codecs, so you
can just grab <code class="highlighter-rouge">hammock-circe</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>libraryDependencies += "hammock" %% "hammock-circe" % "0.1"
</code></pre>
</div>

<p>And use it directly:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">hammock._</span>
<span class="c1">// import hammock._
</span>
<span class="k">import</span> <span class="nn">hammock.circe._</span>
<span class="c1">// import hammock.circe._
</span>
<span class="k">import</span> <span class="nn">hammock.circe.implicits._</span>
<span class="c1">// import hammock.circe.implicits._
</span>
<span class="k">import</span> <span class="nn">io.circe._</span>
<span class="c1">// import io.circe._
</span>
<span class="k">import</span> <span class="nn">io.circe.generic.auto._</span>
<span class="c1">// import io.circe.generic.auto._
</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">MyClass</span><span class="o">(</span><span class="n">stringField</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">intField</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="c1">// defined class MyClass
</span>
<span class="nc">Codec</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">].</span><span class="n">decode</span><span class="o">(</span><span class="s">"""{"stringField": "This is Hammock!", "intField": 33}"""</span><span class="o">)</span>
<span class="c1">// res3: Either[hammock.CodecException,MyClass] = Right(MyClass(This is Hammock!,33))
</span>
<span class="nc">Codec</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">].</span><span class="n">decode</span><span class="o">(</span><span class="s">"this is not a valid json"</span><span class="o">)</span>
<span class="c1">// res4: Either[hammock.CodecException,MyClass] = Left(hammock.CodecException: expected true got t (line 1, column 1))
</span>
<span class="nc">Codec</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">].</span><span class="n">encode</span><span class="o">(</span><span class="nc">MyClass</span><span class="o">(</span><span class="s">"hello dolly"</span><span class="o">,</span> <span class="mi">99</span><span class="o">))</span>
<span class="c1">// res5: String = {"stringField":"hello dolly","intField":99}
</span>
<span class="c1">// Also, you can use Codec's syntax as follows:
</span>
<span class="k">import</span> <span class="nn">Codec._</span>
<span class="c1">// import Codec._
</span>
<span class="s">"""{"stringField": "This is Hammock!", "intField": 33}"""</span><span class="o">.</span><span class="n">decode</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">]</span>
<span class="c1">// res8: Either[hammock.CodecException,MyClass] = Right(MyClass(This is Hammock!,33))
</span>
<span class="s">"this is not a valid json"</span><span class="o">.</span><span class="n">decode</span><span class="o">[</span><span class="kt">MyClass</span><span class="o">]</span>
<span class="c1">// res9: Either[hammock.CodecException,MyClass] = Left(hammock.CodecException: expected true got t (line 1, column 1))
</span>
<span class="nc">MyClass</span><span class="o">(</span><span class="s">"hello dolly"</span><span class="o">,</span> <span class="mi">99</span><span class="o">).</span><span class="n">encode</span>
<span class="c1">// res10: String = {"stringField":"hello dolly","intField":99}
</span></code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/hammock/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/hammock/js/automenu.js"></script><script src="/hammock/js/main.js"></script></body></html>